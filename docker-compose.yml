version: "3"
services:
  monitor:
    build:
      dockerfile: Dockerfile.dev
      context: ./monitor
    command: "'ALL SERVISES are READY! Open http://${API_HOST}:${PORT}/ in your browser.' mysql:3306 backend:${API_PORT} frontend:${PORT}"
    environment:
      - "TERM=${TERM}"
    links:
      - frontend
      - backend
      - mysql
  frontend:
    build:
      dockerfile: Dockerfile.dev
      context: ${FRONTEND_DIR}
    ports:
      - "${PORT}:${PORT}"
      - "8081:8081"
    depends_on:
      - backend
    environment:
      - API_SERVER="http://${API_HOST}:${API_PORT}"
    command: "--port ${PORT} --host 0.0.0.0"
    working_dir: "/code"
    volumes:
      - "${FRONTEND_DIR}:/code"
  backend:
    build:
      dockerfile: Dockerfile.dev
      context: ${BACKEND_DIR}
    ports:
      - "${API_PORT}:${API_PORT}"
    depends_on:
      - mysql
    links:
      - mysql
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - FLASK_DEBUG=1
    command: "--port ${API_PORT} --host 0.0.0.0"
    working_dir: "/code"
    volumes:
      - "${BACKEND_DIR}:/code"
  mysql:
    image: mysql:5
    volumes:
      - "./mysql:/var/lib/mysql"
      - "./mysql-init:/docker-entrypoint-initdb.d"
      - "./mysql-confd:/etc/mysql/conf.d"
    environment:
      - "MYSQL_ROOT_PASSWORD=${MYSQL_PASSWORD}"
    expose:
      - "3306"
    ports:
      - "3306:3306"
