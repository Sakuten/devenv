version: "3"
services:
  monitor:
    build:
      dockerfile: Dockerfile.dev
      context: ./monitor
    command: "'ALL SERVICES are READY! Open http://${API_HOST}:${PORT}/ in your browser.' db:5432 backend:${API_PORT} frontend:${PORT}"
    environment:
      - "TERM=${TERM}"
    links:
      - frontend
      - backend
      - db
  frontend:
    build:
      dockerfile: Dockerfile.dev
      context: ${FRONTEND_DIR}
    ports:
      - "${PORT}:${PORT}"
      - "8081:8081"
    depends_on:
      - backend
    environment:
      - API_SERVER="http://${API_HOST}:${API_PORT}"
    command: "--port ${PORT} --host 0.0.0.0"
    working_dir: "/code"
    volumes:
      - "${FRONTEND_DIR}:/code"
  backend:
    build:
      dockerfile: Dockerfile.dev
      context: ${BACKEND_DIR}
    ports:
      - "${API_PORT}:${API_PORT}"
    depends_on:
      - db
    links:
      - db
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - FLASK_DEBUG=1
    command: "--port ${API_PORT} --host 0.0.0.0"
    working_dir: "/code"
    volumes:
      - "${BACKEND_DIR}:/code"
  db:
    image: postgres:10.4
    environment:
      - "POSTGRES_PASSWORD=${DB_PASSWORD}"
    volumes:
      - "./db:/var/lib/postgresql/data"
    expose:
      - "5432"
    ports:
      - "5432:5432"
