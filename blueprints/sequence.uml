
                                ┌─┐                                                                              ┌─┐                ┌─┐
                                ║"│                                                                              ║"│                ║"│
                                └┬┘                                                                              └┬┘                └┬┘
                                ┌┼┐                                                                              ┌┼┐                ┌┼┐
                                 │                      ┌──────┐                                 ┌──┐             │                  │
                                ┌┴┐                     │Server│                                 │DB│            ┌┴┐                ┌┴┐
                               User                     └──┬───┘                                 └┬─┘           Admin            Reception
                                │                          │                                      │               │                  │
                    ╔═══════════╪═══╤══════════════════════╪══════════════════════════════════════╪═══════════╗   │                  │
                    ║ AUTH SECTION  │                      │                                      │           ║   │                  │
                    ╟───────────────┘   Page request       │                                      │           ║   │                  │
                    ║           │ ─────────────────────────>                                      │           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │    HTTP file response    │                                      │           ║   │                  │
                    ║           │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                                      │           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │────┐                                                            │           ║   │                  │
                    ║           │    │ Take photo of QR code                                      │           ║   │                  │
                    ║           │<───┘                                                            │           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │────┐                     │                                      │           ║   │                  │
                    ║           │    │ Recognize ID/URL    │                                      │           ║   │                  │
                    ║           │<───┘                     │                                      │           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │          Send ID         │                                      │           ║   │                  │
                    ║           │ ─────────────────────────>                                      │           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │                          │           Request user data          │           ║   │                  │
                    ║           │                          │ ─────────────────────────────────────>           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │                          │               User data              │           ║   │                  │
                    ║           │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │   HTTP user's homepage   │                                      │           ║   │                  │
                    ║           │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                                      │           ║   │                  │
                    ║           │                          │                                      │           ║   │                  │
                    ║           │       Process token      │                                      │           ║   │                  │
                    ║           │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                                      │           ║   │                  │
                    ╚═══════════╪══════════════════════════╪══════════════════════════════════════╪═══════════╝   │                  │
                                │                          │                                      │               │                  │
                                │                          │                                      │               │                  │
          ╔═══════╤═════════════╪══════════════════════════╪══════════════════════════════════════╪═══════════════╪══════════════════╪═════════════════════════════════════════╗
          ║ LOOP  │  for all show times                    │                                      │               │                  │                                         ║
          ╟───────┘             │                          │                                      │               │                  │                                         ║
          ║                     │                          │                                      │               │                  │                                         ║
          ║         ╔═══════════╪══════╤═══════════════════╪══════════════════════════════════════╪═══════════╗   │                  │                                         ║
          ║         ║ ADD APPOINTMENT  │                   │                                      │           ║   │                  │                                         ║
          ║         ╟────────────────Appointment request   │                                      │           ║   │                  │                                         ║
          ║         ║           │ ─────────────────────────>                                      │           ║   │                  │                                         ║
          ║         ║           │                          │                                      │           ║   │                  │                                         ║
          ║         ║           │                          │            Add appointment           │           ║   │                  │                                         ║
          ║         ║           │                          │ ─────────────────────────────────────>           ║   │                  │                                         ║
          ║         ╚═══════════╪══════════════════════════╪══════════════════════════════════════╪═══════════╝   │                  │                                         ║
          ║                     │                          │                                      │               │                  │                                         ║
          ║                     │                          │                                      │               │                  │                                         ║
          ║         ╔═══════════╤══════════════════════════╪══════════════════════════════════════╪═══════════════╪════════════╗     │                                         ║
          ║         ║ DRAW LOT  │                          │                                      │               │            ║     │                                         ║
          ║         ╟───────────┘                          │                     Draw request     │               │            ║     │                                         ║
          ║         ║           │                          │ <────────────────────────────────────────────────────│            ║     │                                         ║
          ║         ║           │                          │                                      │               │            ║     │                                         ║
          ║         ║           │                          │         grab appointment data        │               │            ║     │                                         ║
          ║         ║           │                          │ ─────────────────────────────────────>               │            ║     │                                         ║
          ║         ║           │                          │                                      │               │            ║     │                                         ║
          ║         ║           │                          │ Return all appointment for given draw│               │            ║     │                                         ║
          ║         ║           │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─               │            ║     │                                         ║
          ║         ║           │                          │                                      │               │            ║     │                                         ║
          ║         ║           │                          │────┐                                 │               │            ║     │                                         ║
          ║         ║           │                          │    │ draw the lot                    │               │            ║     │                                         ║
          ║         ║           │                          │<───┘                                 │               │            ║     │                                         ║
          ║         ║           │                          │                                      │               │            ║     │                                         ║
          ║         ║           │                          │           Write the result           │               │            ║     │                                         ║
          ║         ║           │                          │ ─────────────────────────────────────>               │            ║     │                                         ║
          ║         ║           │                          │                                      │               │            ║     │                                         ║
          ║         ║           │                          │                     tell drawed      │               │            ║     │                                         ║
          ║         ║           │                          │ ────────────────────────────────────────────────────>│            ║     │                                         ║
          ║         ║           │                          │                                      │               │            ║     │                                         ║
          ║         ║           │      tell the result     │                                      │               │            ║     │                                         ║
          ║         ║           │ <─────────────────────────                                      │               │            ║     │                                         ║
          ║         ╚═══════════╪══════════════════════════╪══════════════════════════════════════╪═══════════════╪════════════╝     │                                         ║
          ║                     │                          │                                      │               │                  │                                         ║
          ║                     │                          │                                      │               │                  │                                         ║
          ║         ╔═══════════╪════════════╤═════════════╪══════════════════════════════════════╪═══════════════╪══════════════════╪═══════════════════════════════╗         ║
          ║         ║ ACCESS FROM RECEPTION  │             │                                      │               │                  │                               ║         ║
          ║         ╟────────────────────────┘             │                 show QR code         │               │                  │                               ║         ║
          ║         ║           │ ──────────────────────────────────────────────────────────────────────────────────────────────────>│                               ║         ║
          ║         ║           │                          │                                      │               │                  │                               ║         ║
          ║         ║           │                          │                                      │               │                  ────┐                           ║         ║
          ║         ║           │                          │                                      │               │                      │ recognize visitor's ID    ║         ║
          ║         ║           │                          │                                      │               │                  <───┘                           ║         ║
          ║         ║           │                          │                                      │               │                  │                               ║         ║
          ║         ║           │                          │                                 Send ID              │                  │                               ║         ║
          ║         ║           │                          │ <───────────────────────────────────────────────────────────────────────│                               ║         ║
          ║         ║           │                          │                                      │               │                  │                               ║         ║
          ║         ║           │                          │            Is ID correct?            │               │                  │                               ║         ║
          ║         ║           │                          │ ─────────────────────────────────────>               │                  │                               ║         ║
          ║         ║           │                          │                                      │               │                  │                               ║         ║
          ║         ║           │                          │              The result              │               │                  │                               ║         ║
          ║         ║           │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─               │                  │                               ║         ║
          ║         ║           │                          │                                      │               │                  │                               ║         ║
          ║         ║           │                          │                            Return the result         │                  │                               ║         ║
          ║         ║           │                          │ ───────────────────────────────────────────────────────────────────────>│                               ║         ║
          ║         ║           │                          │                                      │               │                  │                               ║         ║
          ║         ║           │                          │               Tell the result        │               │                  │                               ║         ║
          ║         ║           │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │                               ║         ║
          ║         ╚═══════════╪══════════════════════════╪══════════════════════════════════════╪═══════════════╪══════════════════╪═══════════════════════════════╝         ║
          ╚═════════════════════╪══════════════════════════╪══════════════════════════════════════╪═══════════════╪══════════════════╪═════════════════════════════════════════╝
                                │                          │                                      │               │                  │
                                │                          │────┐                                 │               │                  │
                                │                          │    │ Disable all access token        │               │                  │
                                │                          │<───┘                                 │               │                  │
                               User                     ┌──┴───┐                                 ┌┴─┐           Admin            Reception
                                ┌─┐                     │Server│                                 │DB│            ┌─┐                ┌─┐
                                ║"│                     └──────┘                                 └──┘            ║"│                ║"│
                                └┬┘                                                                              └┬┘                └┬┘
                                ┌┼┐                                                                              ┌┼┐                ┌┼┐
                                 │                                                                                │                  │
                                ┌┴┐                                                                              ┌┴┐                ┌┴┐

@startuml

group Auth section
  actor User
  User -> Server : Page request
  User <-- Server : HTTP file response
  User -> User : Take photo of QR code
  User -> User : Recognize ID/URL
  User -> Server : Send ID
  Server -> DB : Request user data
  Server <-- DB : User data
  User <-- Server  : HTTP user's homepage
  User <-- Server  : Process token
end

loop for all show times
  group Add appointment
    User -> Server : Appointment request
    Server -> DB : Add appointment
  end

  group draw lot
    actor Admin
    Admin -> Server : Draw request
    Server -> DB : grab appointment data
    Server <-- DB : Return all appointment for given draw
    Server -> Server : draw the lot
    Server -> DB : Write the result
    Server -> Admin : tell drawed
    ' is it needed to tell automatically?
    Server -> User : tell the result
  end

  group access from reception
    actor Reception
    User -> Reception : show QR code
    Reception -> Reception : recognize visitor's ID
    Reception -> Server : Send ID
    Server -> DB : Is ID correct?
    Server <-- DB : The result
    Server -> Reception : Return the result
    User <-- Reception : Tell the result
  end
end

Server -> Server : Disable all access token

@enduml
